{% load static %}
<!DOCTYPE html>


<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'musicnote/basestyle.css' %}">
    <link rel="stylesheet" href="{% static 'musicnote/searchstyle.css' %}">
    <link rel="stylesheet" href="{% static 'musicnote/Menu/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css">
    <link rel="stylesheet" href="{% static 'musicnote/sliderIndex/style.css' %}">

    <link rel="shortcut icon" href="{% static 'musicnote/favicon.ico' %}" type="image/ico">

    <title>MusicBox</title>
</head>
<body>

    <canvas id="space-background"></canvas>

    <header>
        <div class="container">
            <div class="logo">MusicNote</div>
            <nav>
            <ul class="nav-links">
                <li><a href="{% url 'musicnote:home' %}">Accueil</a></li>
                <li><a href="{% url 'musicnote:index' %}">Rechercher</a></li>
                {% if user.is_authenticated %}
                <li><a href="{% url 'musicnote:user' user.pk %}">Ma page</a></li>
                <li><a href="{% url 'musicnote:logout' %}">Se déconnecter</a></li>
                <li class="nav-user">{{ user }}</li>
                {% else %}
                <li><a href="{% url 'musicnote:login' %}">Se connecter</a></li>
                {% endif %}
            </ul>
            <!-- Hamburger -->
            <div id="nav-icon1">
                <span></span>
                <span></span>
                <span></span>
            </div>
            </nav>
        </div>
    </header>


    <h1>Faites vibrer vos playlists !</h1>

    <p class="indic-text">Sur MusicBox, chaque morceau mérite sa note.<br> Donnez votre avis, découvrez les tendances et partagez vos coups de cœur musicaux !</p>    

    <h2>Cherche ton morceau préféré</h2>
    <form>
    <input type="text" id="search" placeholder="Tape un nom de chanson ou artiste...">
    </form>
    <ul id="results">
        <li class="no-result">Commence à taper pour voir des résultats...</li>
    </ul>


    <h2>Les dernières notes de la communauté</h2>

    <div class="splide" id="slider-1">
        <div class="splide__track">
            <ul class="splide__list">
            
            {% for review in last_songs_1 %}
            
                <li class="splide__slide">
                    <div class="slide-content">
                        <a href="{% url 'musicnote:song' review.song.id %}">
                            <img src="{{ review.song.cover }}" alt="Logo 1" />
                            <p><strong>{{review.song.name}}</strong></p>
                        </a>
                    </div>
                </li>


            {% endfor %}
            </ul>
        </div>
    </div>

    {% if last_songs_2 %}

    <div class="splide" id="slider-2">
        <div class="splide__track">
            <ul class="splide__list">
            
            {% for review in last_songs_2 %}
            
                <li class="splide__slide">
                    <div class="slide-content">
                        <img src="{{ review.song.cover }}" alt="Logo 1" />
                        <p><strong>{{review.song.name}}</strong></p>
                    </div>
                </li>


            {% endfor %}
            
            </ul>
        </div>
    </div>
    
    {% endif %}















    <script>
        const searchInput = document.getElementById('search');
        const resultsList = document.getElementById('results');

        searchInput.addEventListener('input', function() {
            const query = this.value.trim();

            if (query.length < 2) {
                resultsList.innerHTML = '<li class="no-result">Commence à taper pour voir des résultats...</li>';
                return;
            }

            fetch(`/search/?q=${encodeURIComponent(query)}`)
                .then(response => {
                    if (!response.ok) throw new Error("Erreur réseau");
                    return response.json();
                })
                .then(data => {
                    resultsList.innerHTML = '';

                    if (!data.tracks || data.tracks.length === 0) {
                        resultsList.innerHTML = '<li class="no-result">Aucun résultat</li>';
                        return;
                    }

                    data.tracks.forEach(track => {
                        if (track.in_data_base){
                            const li = document.createElement('li');
                            li.innerHTML = `
                                <a href="/song/${track.id}"> <strong>${track.title}</strong> – ${track.artist.name}<br> </a>
                            `;
                            resultsList.appendChild(li);
                        }else{
                            const li = document.createElement('li');
                            li.innerHTML = `
                                <a href="/add_deezer_song/${track.deezer_id}">
                                <strong>${track.title}</strong> – ${track.artist.name}
                                </a>
                            `;
                            resultsList.appendChild(li);
                        }

                    });
                })
                .catch(error => {
                    resultsList.innerHTML = `<li class="no-result">Erreur : ${error.message}</li>`;
                });
        });
    </script>


    
    <script src="{% static 'musicnote/space.js' %}"></script>
    <script src="{% static 'musicnote/Menu/script.js' %}"></script>


    <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js"></script>
    <script src="{% static 'musicnote/sliderIndex/script.js' %}"></script>










</body>
</html>